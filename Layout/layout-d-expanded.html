<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Layout D – Expanded View</title>
  <style>
    :root { --card-w: 90vw; --card-h: 80vh; }

    * { box-sizing: border-box; }
    body{
      margin:0; padding:0; background:#111; color:#fff;
      font-family:"Segoe UI",system-ui,Arial,sans-serif;
      display:flex; flex-direction:column; align-items:center;
    }
    h1{ margin:20px; }

    /* Fixed viewport: no native scrollbars */
    .viewport{
      width:var(--card-w); height:var(--card-h);
      border-radius:12px; background:#000;
      box-shadow:0 0 15px rgba(255,255,255,.1);
      overflow:hidden; position:relative; user-select:none; touch-action:none;
    }

    /* We transform this wrapper (translate + scale) */
    .stage{
      position:absolute; inset:0;
      transform-origin:0 0;
      will-change: transform;
    }

    /* The drawing lives inside this SVG so you can add hotspots later */
    svg#sheet{ width:100%; height:100%; display:block; }
    image#bg{ pointer-events:none; } /* image never steals clicks */

    /* UI */
    .toolbar{
      position:absolute; top:10px; right:10px; z-index:10;
      display:flex; gap:8px; background:rgba(40,40,40,.75);
      border:1px solid rgba(255,255,255,.15); border-radius:10px;
      padding:6px 8px; backdrop-filter: blur(4px);
    }
    .btn{
      appearance:none; border:none; border-radius:8px; cursor:pointer;
      padding:6px 10px; font-weight:700; color:#000;
      background:#ffcc00; box-shadow:0 2px 6px rgba(0,0,0,.35);
    }
    .btn:hover{ background:#ffe066; }
    .readout{ color:#ddd; font-weight:600; padding:6px 8px; }

    .hint{
      position:absolute; left:12px; bottom:12px; z-index:10;
      color:#ddd; background:rgba(0,0,0,.45); padding:6px 10px;
      border-radius:8px; font-size:12px; border:1px solid rgba(255,255,255,.12);
    }

    .back-button{
      margin:20px; background:#ffcc00; color:#000; font-weight:700;
      padding:10px 20px; border-radius:8px; text-decoration:none;
      box-shadow:0 4px 10px rgba(0,0,0,.3);
    }
    .back-button:hover{ background:#ffe066; }

    .grabbing{ cursor:grabbing !important; }
  </style>
</head>
<body>
  <h1>Layout D - Expanded View</h1>

  <div class="viewport" id="viewport">
    <div class="toolbar">
      <button class="btn" id="zoomOut">−</button>
      <div class="readout" id="zoomPct">100%</div>
      <button class="btn" id="zoomIn">+</button>
      <button class="btn" id="reset">Reset</button>
    </div>
    

    <div class="stage" id="stage">
      <!-- SVG wrapper with your large PNG as background -->
      <svg id="sheet" xmlns="http://www.w3.org/2000/svg">
        <!-- Change the href to your high-res export (e.g. 4500px wide) -->
        <image id="bg" href="layout_page1.png" x="0" y="0" />
        <!-- Later: add hotspots here (rect/polygon + anchors) -->
      </svg>
    </div>
  </div>

  <a href="layout-section.html" class="back-button">← Back</a>

  <script>
  (function(){
    const viewport = document.getElementById('viewport');
    const stage    = document.getElementById('stage');
    const sheet    = document.getElementById('sheet');
    const bg       = document.getElementById('bg');

    const zoomOutBtn = document.getElementById('zoomOut');
    const zoomInBtn  = document.getElementById('zoomIn');
    const resetBtn   = document.getElementById('reset');
    const readout    = document.getElementById('zoomPct');

    let scale = 1, minScale = 1, maxScale = 6;
    let tx = 0, ty = 0;
    let dragging = false, lastX = 0, lastY = 0;

    function applyTransform(){
      stage.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
      readout.textContent = Math.round(scale*100) + '%';
    }
    function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

    function zoomAt(mx, my, factor){
      const newScale = clamp(scale * factor, minScale, maxScale);
      // keep point under cursor stable
      tx = mx - (mx - tx) * (newScale / scale);
      ty = my - (my - ty) * (newScale / scale);
      scale = newScale;
      applyTransform();
    }

    function wheelZoom(e){
      // Ignore Ctrl+Wheel (browser zoom)
      if (e.ctrlKey) return;
      e.preventDefault();
      const rect = viewport.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      zoomAt(mx, my, (e.deltaY < 0) ? 1.12 : 1/1.12);
    }

    function startPan(e){
      // Right mouse OR (Alt/Ctrl/Meta + left)
      const canPan = (e.button === 2) || (e.button === 0 && (e.altKey || e.ctrlKey || e.metaKey));
      if (!canPan) return;
      e.preventDefault();
      dragging = true; lastX = e.clientX; lastY = e.clientY;
      viewport.classList.add('grabbing');
    }
    function movePan(e){
      if (!dragging) return;
      const dx = e.clientX - lastX;
      const dy = e.clientY - lastY;
      lastX = e.clientX; lastY = e.clientY;
      tx += dx; ty += dy;
      applyTransform();
    }
    function endPan(){
      dragging = false; viewport.classList.remove('grabbing');
    }
    viewport.addEventListener('contextmenu', e => e.preventDefault());

    function reset(){
      scale = minScale; // fit to view
      // center the content
      const rect = viewport.getBoundingClientRect();
      const contentW = sheet.viewBox.baseVal.width  || rect.width;
      const contentH = sheet.viewBox.baseVal.height || rect.height;
      const sx = rect.width  / contentW;
      const sy = rect.height / contentH;
      minScale = Math.min(sx, sy); // fit scale
      scale = minScale;
      tx = (rect.width  - contentW * scale) / 2;
      ty = (rect.height - contentH * scale) / 2;
      applyTransform();
    }

    // Setup the SVG viewBox using the image's natural size
    function setupOnceImageLoads(){
      // Create an HTML Image to read natural size
      const probe = new Image();
      probe.onload = () => {
        const w = probe.naturalWidth, h = probe.naturalHeight;
        // Size the <image> and set SVG viewBox to real pixels
        bg.setAttribute('width',  w);
        bg.setAttribute('height', h);
        sheet.setAttribute('viewBox', `0 0 ${w} ${h}`);
        // Fit to viewport
        reset();
      };
      probe.src = bg.getAttribute('href') || bg.getAttribute('xlink:href');
    }

    // Bind zoom/pan
    viewport.addEventListener('wheel', wheelZoom, { passive:false });
    viewport.addEventListener('dblclick', reset);
    viewport.addEventListener('mousedown', startPan);
    window.addEventListener('mousemove', movePan);
    window.addEventListener('mouseup', endPan);

    // Buttons
    zoomInBtn.addEventListener('click', ()=>{
      const r = viewport.getBoundingClientRect();
      zoomAt(r.width/2, r.height/2, 1.2);
    });
    zoomOutBtn.addEventListener('click', ()=>{
      const r = viewport.getBoundingClientRect();
      zoomAt(r.width/2, r.height/2, 1/1.2);
    });
    resetBtn.addEventListener('click', reset);

    setupOnceImageLoads();
  })();
  </script>
</body>
</html>
